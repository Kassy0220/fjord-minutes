<div class="mx-auto w-full">
  <div class="mx-auto">
    <%= render 'courses/tabs/course_tab', active_tab: @course, resource: Member %>

    <h2 class="mb-8 text-2xl font-bold text-center"><%= "#{@course.name}のメンバー" %></h2>

    <% if admin_signed_in? %>
      <% active_tab = params[:status] ? params[:status] : 'active' %>
      <%= render 'status_tab', course: @course, active_tab: active_tab %>
    <% end %>

    <div>
      <ul class="list-disc list-inside">
        <% @members.each do |member| %>
          <li class="mb-6" data-member="<%= member.id %>">
            <%= image_tag member.avatar_url, class: 'w-12 h-12 inline-block rounded-full border border-gray-300' %>
            <%= link_to "#{member.name}", member, class: "py-3 inline-block" %>
            <% if member.hibernated? %>
              <span class="text-sm text-gray-500">離脱中</span>
            <% end %>
            <% if admin_signed_in? && !member.hibernated? %>
              <%= content_tag :div, class: 'hibernation_button inline-block', data: {member_id: member.id, member_name: member.name}.to_json do %><% end %>
            <% end %>
            <div class="my-2">
              <div class="flex">
                <% member.recent_attendances.each do |attendance| %>
                  <div class="w-16 text-center first:border [&:nth-child(n+2)]:border-t [&:nth-child(n+2)]:border-r [&:nth-child(n+2)]:border-b border-gray-400 p-2 bg-gray-200"
                       data-table-head="<%= attendance[:date].strftime('%Y-%m-%d') %>">
                    <%= attendance[:date].strftime('%m/%d') %>
                  </div>
                <% end %>
              </div>
              <div class="flex">
                <% member.recent_attendances.each do |attendance| %>
                  <div class="w-16 text-center first:border-l border-r border-b border-gray-400 p-2" data-table-body="<%= attendance[:date].strftime('%Y-%m-%d') %>">
                    <% if attendance[:status] == 'absent' %>
                      <span data-tooltip-target="tooltip_absence_reason">
                        <%= attendance_status(attendance[:status], attendance[:time]) %>
                      </span>

                      <div id="tooltip_absence_reason" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-700 rounded-lg shadow-sm opacity-0 tooltip">
                        <%= attendance[:absence_reason] %>
                        <div class="tooltip-arrow" data-popper-arrow></div>
                      </div>
                    <% else %>
                      <%= attendance_status(attendance[:status], attendance[:time]) %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
